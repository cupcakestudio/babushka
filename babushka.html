<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bistro Babushka</title>
  <style>
    h1 {
    text-decoration-line: underline ;
    }
    img {
      padding-top: 5% ;
      max-width: 100%;
    }
    main {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      grid-gap: 10px;
    }
    article {
      border: 1px solid #fb923c;
      border-radius: 5% 5% 0% 0%;
      cursor: pointer;
    }
    button {
      text-align: center;
      margin-bottom: 10px;
    }
    
    button.valgt  {
      background-color: #f97316;
      border-color: #ffedd5;
    }

    #popop {
     display: none;
      position: fixed;
      top: 10%;
      left: 10%;
      width: 80vw;
      height: 80vh;
      background-color:#c2410c;
      border-radius: 3%;
      overflow: scroll; /* selve sectionen scrollbar*/ 
    }
    #popop > #luk {
      
      margin: 10px;
      cursor: pointer;
      position: fixed;
    }
    #popop article{
        display: flex;
        flex-direction: column;
        text-align: center;
        align-self: center;
        margin: 4rem auto;
        padding: 10px;
        width: 70vw;
        background-color: #fff7ed;
        cursor: default;
    }
    
  </style>
</head>

<body>
  <!--     pop-op vindue -->
  <section id="popop">
      <button id ="luk"> LUK</button>
      <article>
        <h3> <span class="titel"></span></h3>
        <img src="" alt="" class="retPopopImg">
        <p><span class="kategori"></span></p>
        <p><span class="langbeskrivelse"></span></p>
        <p><span class="kortbeskrivelse"></span></p>
        <p> <span class="prisPopop"></span> </p>
      </article>
    </section>
  <h1>Alle retter</h1>
  <nav> 
    <!-- dataset for attr værdien (data-<indsæt key attr fra jsonarray) fra data-attributen -->
      <button data-kategori="alle" class="valgt">Alle retter</button>
      <button data-kategori="hovedretter">Hovedretter</button>
      <button data-kategori="forretter">Forretter</button>
      <button data-kategori="sideorders">Sideorders</button>
      <button data-kategori="desserter">Desserter</button>
      <button data-kategori="drikkevarer">Drikkevarer</button>
    </nav>
  <main>
    
  </main>
 <!-- skabelon for article divernes indhold -->
 <template>
  <article>
    <img src="" alt="" class="billede">
    <h2 class ="navn"></h2>
    <p class="kategori"></p>
    <p class="kortbeskrivelse"></p>
    <p class="pris"></p>
  </article>
</template>

</body>

<script>


const bistrofil = "https://babushka-dd8a.restdb.io/rest/menu";

const options = {
  headers: {"x-apikey":"600ec2fb1346a1524ff12de4"}
};



document.addEventListener("DOMContentLoaded", start);
//globale var
let filter = "alle";
let retterValg;

function start(){
const filterKnapper = document.querySelectorAll("nav button"); //vælg filterknapperne fra DOM
filterKnapper.forEach(knap => knap.addEventListener("click", filterRetter)); //tilknyt funktionskald på filterknap for kver knap
hentBistroData();
 
}

async function hentBistroData(){
  const resultat = await fetch(bistrofil, options);
  retterValg = await resultat.json(); //retterValg er var der indholder vores JSON data
  vis();

}
function filterRetter(){
  filter = this.dataset.kategori; //finder værdi som filter-var sættes lig med
  document.querySelector("h1").textContent = this.textContent //EventHandler funktionen sørger også for at h1-indhold opdateres, this ref. til klikket knap.
  //fremhæv aktuelle knap
  //fjern .valgt fra default/forrige knap
  document.querySelector(".valgt").classList.remove("valgt");
  //tilføj .valgt til aktive knap
  this.classList.add("valgt");
  vis();
}
//full loop view w/ Filtering
function vis(){
  const main = document.querySelector("main");
  const template = document.querySelector("template").content; 
  main.textContent = ""; //slet indhold fra liste, hver gang liste skal loades på ny

  retterValg.forEach(retter => {
  //if statement for alle filterknapper der klikkes på
  //filterer værdierne der er blevet klikket på sammenlignes med deres tilsvarende kategori og propergeres ned i if statement.
  if (filter == retter.kategori || filter == "alle") { 

    const clone = template.cloneNode(true);
    clone.querySelector(".billede").src = "images/medium/" +  retter.billednavn + "-md.jpg"; //billedenavn property ref. til billede og filen der ligger som et array
    clone.querySelector(".navn").textContent =  retter.navn; //ændre Nodens textindhold til retter.navn
    clone.querySelector(".kategori").textContent =  retter.kategori;
    clone.querySelector(".kortbeskrivelse").textContent = retter.kortbeskrivelse;
    clone.querySelector(".pris").textContent = "Pris: " + retter.pris + " kr.";
    //eventhandler til når der bliver klikket på
    clone.querySelector("article").addEventListener("click", () => visPopop(retter));  
    
    main.appendChild(clone); //tilføj til main 
  } 
})
}

//viser pop-op-vindue med indsatte data elementer
function visPopop(retter){
  const popop = document.querySelector("#popop")
  popop.style.display = "block"; //viser popop vinduet, ændre display fra none til block
  popop.querySelector(".titel").textContent = "Titel: " + retter.navn;
  popop.querySelector(".titel").style.textDecoration = "underline";
  popop.querySelector(".kategori").textContent = retter.kategori;
  popop.querySelector(".kategori").style.fontWeight = "bold";
  popop.querySelector(".retPopopImg").src = "images/medium/" +  retter.billednavn + "-md.jpg";
  popop.querySelector(".langbeskrivelse").textContent = retter.langbeskrivelse;
  popop.querySelector(".kortbeskrivelse").textContent = "";
  popop.querySelector(".langbeskrivelse").style.textAlign = "start";
  popop.querySelector(".prisPopop").textContent = "Pris: " +retter.pris + "kr."
  //kort tekst til sideorder filtering og alle filtering i popopview
  if (filter == "sideorders" || filter == "alle"){
    
    const shortdescrip = document.createElement("p");
    shortdescrip.classList.add("kortbeskrivelse");
    popop.querySelector(".kortbeskrivelse").textContent = retter.kortbeskrivelse;
    popop.querySelector(".kortbeskrivelse").appendChild(shortdescrip);
  }
  //lukker popop'en ned
  popop.querySelector("#luk").addEventListener("click", () => popop.style.display = "none");  
}


  hentBistroData();
</script>
</html>